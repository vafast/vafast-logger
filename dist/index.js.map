{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @vafast/logger - High-performance logging plugin for Vafast\n * \n * Based on Pino for maximum performance\n */\nimport pino from 'pino'\nimport type { Logger, LoggerOptions } from 'pino'\n\n// ============ Types ============\n\nexport interface VafastLoggerConfig {\n  /** 日志级别 @default 'info' */\n  level?: 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'fatal' | 'silent'\n  /** 是否为生产环境 @default false */\n  production?: boolean\n  /** 应用名称，会添加到每条日志 */\n  name?: string\n  /** 自定义 pino 配置 */\n  pinoOptions?: LoggerOptions\n  /** 是否启用美化输出（开发环境） @default true */\n  pretty?: boolean\n  /** 美化输出配置 */\n  prettyOptions?: {\n    colorize?: boolean\n    translateTime?: string\n    ignore?: string\n  }\n}\n\nexport interface LogContext {\n  [key: string]: unknown\n}\n\n// ============ Logger Factory ============\n\n/**\n * 创建 Vafast Logger 实例\n * \n * @example\n * ```typescript\n * import { createLogger } from '@vafast/logger'\n * \n * const logger = createLogger({\n *   name: 'my-app',\n *   level: 'debug',\n *   production: process.env.NODE_ENV === 'production'\n * })\n * \n * logger.info('Server started')\n * logger.error({ err }, 'Request failed')\n * ```\n */\nexport function createLogger(config: VafastLoggerConfig = {}): Logger {\n  const {\n    level = 'info',\n    production = false,\n    name,\n    pinoOptions = {},\n    pretty = true,\n    prettyOptions = {}\n  } = config\n\n  const options: LoggerOptions = {\n    level: production ? 'info' : level,\n    ...(name && { name }),\n    ...pinoOptions,\n  }\n\n  // 开发环境启用美化输出\n  if (!production && pretty) {\n    options.transport = {\n      target: 'pino-pretty',\n      options: {\n        colorize: prettyOptions.colorize ?? true,\n        translateTime: prettyOptions.translateTime ?? 'SYS:standard',\n        ignore: prettyOptions.ignore ?? 'pid,hostname',\n      }\n    }\n  }\n\n  return pino(options)\n}\n\n// ============ Child Logger Factory ============\n\n/**\n * 创建子 Logger（带模块标识）\n * \n * @example\n * ```typescript\n * const logger = createLogger({ name: 'my-app' })\n * const dbLogger = createChildLogger(logger, 'database')\n * const authLogger = createChildLogger(logger, 'auth')\n * \n * dbLogger.info('Connected')  // [my-app] [database] Connected\n * authLogger.warn('Token expired')  // [my-app] [auth] Token expired\n * ```\n */\nexport function createChildLogger(parent: Logger, module: string): Logger {\n  return parent.child({ module })\n}\n\n// ============ Utility Functions ============\n\n/**\n * 记录错误日志（结构化）\n */\nexport function logError(\n  logger: Logger,\n  error: Error,\n  message?: string,\n  context?: LogContext\n): void {\n  logger.error({\n    err: {\n      message: error.message,\n      name: error.name,\n      stack: error.stack,\n    },\n    ...context,\n  }, message ?? error.message)\n}\n\n/**\n * 记录请求日志\n */\nexport function logRequest(\n  logger: Logger,\n  method: string,\n  path: string,\n  status: number,\n  duration: number,\n  context?: LogContext\n): void {\n  const level = status >= 500 ? 'error' : status >= 400 ? 'warn' : 'info'\n  logger[level]({\n    method,\n    path,\n    status,\n    duration,\n    ...context,\n  }, `${method} ${path} ${status} ${duration}ms`)\n}\n\n// ============ Pre-configured Loggers ============\n\n/**\n * 预配置的 Logger 模块\n * \n * @example\n * ```typescript\n * import { createLoggerSet } from '@vafast/logger'\n * \n * const loggers = createLoggerSet({\n *   name: 'ones-server',\n *   production: process.env.NODE_ENV === 'production'\n * })\n * \n * loggers.app.info('Server started')\n * loggers.db.debug('Query executed')\n * loggers.route.info('GET /api/users')\n * ```\n */\nexport interface LoggerSet {\n  /** 主应用日志 */\n  app: Logger\n  /** 路由请求日志 */\n  route: Logger\n  /** 数据库操作日志 */\n  db: Logger\n  /** 中间件日志 */\n  middleware: Logger\n  /** 认证日志 */\n  auth: Logger\n  /** 外部服务日志（AI、第三方 API 等） */\n  external: Logger\n}\n\nexport function createLoggerSet(config: VafastLoggerConfig = {}): LoggerSet {\n  const app = createLogger(config)\n  \n  return {\n    app,\n    route: createChildLogger(app, 'route'),\n    db: createChildLogger(app, 'db'),\n    middleware: createChildLogger(app, 'middleware'),\n    auth: createChildLogger(app, 'auth'),\n    external: createChildLogger(app, 'external'),\n  }\n}\n\n// ============ Re-exports ============\n\nexport { pino }\nexport type { Logger, LoggerOptions } from 'pino'\n\n// Default export\nexport default createLogger\n\n"],"mappings":";AAKA,OAAO,UAAU;AA+CV,SAAS,aAAa,SAA6B,CAAC,GAAW;AACpE,QAAM;AAAA,IACJ,QAAQ;AAAA,IACR,aAAa;AAAA,IACb;AAAA,IACA,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,IACT,gBAAgB,CAAC;AAAA,EACnB,IAAI;AAEJ,QAAM,UAAyB;AAAA,IAC7B,OAAO,aAAa,SAAS;AAAA,IAC7B,GAAI,QAAQ,EAAE,KAAK;AAAA,IACnB,GAAG;AAAA,EACL;AAGA,MAAI,CAAC,cAAc,QAAQ;AACzB,YAAQ,YAAY;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,UAAU,cAAc,YAAY;AAAA,QACpC,eAAe,cAAc,iBAAiB;AAAA,QAC9C,QAAQ,cAAc,UAAU;AAAA,MAClC;AAAA,IACF;AAAA,EACF;AAEA,SAAO,KAAK,OAAO;AACrB;AAiBO,SAAS,kBAAkB,QAAgB,QAAwB;AACxE,SAAO,OAAO,MAAM,EAAE,OAAO,CAAC;AAChC;AAOO,SAAS,SACd,QACA,OACA,SACA,SACM;AACN,SAAO,MAAM;AAAA,IACX,KAAK;AAAA,MACH,SAAS,MAAM;AAAA,MACf,MAAM,MAAM;AAAA,MACZ,OAAO,MAAM;AAAA,IACf;AAAA,IACA,GAAG;AAAA,EACL,GAAG,WAAW,MAAM,OAAO;AAC7B;AAKO,SAAS,WACd,QACA,QACA,MACA,QACA,UACA,SACM;AACN,QAAM,QAAQ,UAAU,MAAM,UAAU,UAAU,MAAM,SAAS;AACjE,SAAO,KAAK,EAAE;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EACL,GAAG,GAAG,MAAM,IAAI,IAAI,IAAI,MAAM,IAAI,QAAQ,IAAI;AAChD;AAoCO,SAAS,gBAAgB,SAA6B,CAAC,GAAc;AAC1E,QAAM,MAAM,aAAa,MAAM;AAE/B,SAAO;AAAA,IACL;AAAA,IACA,OAAO,kBAAkB,KAAK,OAAO;AAAA,IACrC,IAAI,kBAAkB,KAAK,IAAI;AAAA,IAC/B,YAAY,kBAAkB,KAAK,YAAY;AAAA,IAC/C,MAAM,kBAAkB,KAAK,MAAM;AAAA,IACnC,UAAU,kBAAkB,KAAK,UAAU;AAAA,EAC7C;AACF;AAQA,IAAO,gBAAQ;","names":[]}